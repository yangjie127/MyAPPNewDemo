package com.yang.user.mynewsdemo;import android.app.Activity;import android.content.DialogInterface;import android.content.Intent;import android.content.SharedPreferences;import android.os.Bundle;import android.support.design.widget.BottomSheetDialog;import android.support.design.widget.NavigationView;import android.support.v4.app.FragmentActivity;import android.support.v4.app.FragmentManager;import android.support.v4.app.FragmentTransaction;import android.support.v4.widget.DrawerLayout;import android.support.v7.app.ActionBarDrawerToggle;import android.support.v7.app.AlertDialog;import android.support.v7.widget.Toolbar;import android.util.Log;import android.view.KeyEvent;import android.view.LayoutInflater;import android.view.MenuItem;import android.view.View;import android.view.Window;import android.widget.TextView;import android.widget.Toast;import com.yang.user.mynewsdemo.ui.fragment.AboutFragment;import com.yang.user.mynewsdemo.ui.fragment.GankMainFragment;import com.yang.user.mynewsdemo.ui.fragment.GoldMainFragment;import com.yang.user.mynewsdemo.ui.fragment.LikeFragment;import com.yang.user.mynewsdemo.ui.fragment.SettingFragment;import com.yang.user.mynewsdemo.ui.fragment.VtexMainFragment;import com.yang.user.mynewsdemo.ui.fragment.WechatMainFragment;import com.yang.user.mynewsdemo.ui.fragment.ZhihuMainFragment;import javax.inject.Inject;import butterknife.BindView;import butterknife.ButterKnife;import de.hdodenhof.circleimageview.CircleImageView;import me.shaohui.shareutil.ShareConfig;import me.shaohui.shareutil.ShareManager;import me.shaohui.shareutil.ShareUtil;import me.shaohui.shareutil.share.ShareListener;import me.shaohui.shareutil.share.SharePlatform;public class MainActivity extends FragmentActivity implements View.OnClickListener{    @BindView(R.id.drawer)    DrawerLayout mDrawwerLayout;    @BindView(R.id.toolbar)    Toolbar mToolbar;    @BindView(R.id.navigation)    NavigationView mNavigationView;    ActionBarDrawerToggle mDrawerToggle;    /**     * DrawerLayout  Fragment     */    @Inject    ZhihuMainFragment mZhihuFragment;    @Inject    GankMainFragment mGankFragment;    @Inject    WechatMainFragment mWechatFragment;    @Inject    GoldMainFragment mGoldFragment;    @Inject    VtexMainFragment mVtexFragment;    @Inject    LikeFragment mLikeFragment;    @Inject    SettingFragment mSettingFragment;    @Inject    AboutFragment mAboutFragment;    private ShareListener mShareListener;    private FragmentManager fm;    private FragmentTransaction ft;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        requestWindowFeature(Window.FEATURE_NO_TITLE);        setContentView(R.layout.activity_main);        ButterKnife.bind(this);        fm = this.getSupportFragmentManager();        mNavigationView.getMenu().findItem(R.id.drawer_zhihu).setChecked(false);        //给Toolbar加一个按钮图标        mDrawerToggle = new ActionBarDrawerToggle(this, mDrawwerLayout, mToolbar, R.string.drawer_open, R.string.drawer_close);        get_Info();        mDrawerToggle.syncState();        mDrawwerLayout.addDrawerListener(mDrawerToggle);        mToolbar.setTitle("知乎日报");        SelectFragment(R.id.drawer_zhihu);        mNavigationView.setCheckedItem(R.id.drawer_zhihu);        initEventAndData();//        TextView textView = (TextView) findViewById(R.id.text);        String text = ("Product Model: " + android.os.Build.MODEL + ","                + android.os.Build.VERSION.SDK + ","                + android.os.Build.VERSION.RELEASE);        Log.e("yangjie","" + text);    }    private BottomSheetDialog dialog;    private void initEventAndData() {        mNavigationView.setNavigationItemSelectedListener(new NavigationView.OnNavigationItemSelectedListener() {            @Override            public boolean onNavigationItemSelected(MenuItem menuItem) {                SelectFragment(menuItem.getItemId());                mToolbar.setTitle(menuItem.getTitle());                mDrawwerLayout.closeDrawers();                switch (menuItem.getItemId()){                    case R.id.drawer_zhihu:                        if (message) {                        } else {                            alert_info();                        }                        break;                    case R.id.drawer_wechat:                        if (message) {                        } else {                            alert_info();                        }                        break;                    case R.id.drawer_gank:                        if (message) {                        } else {                            alert_info();                        }                        break;                    case R.id.drawer_gold:                        if (message) {                        } else {                            alert_info();                        }                        break;                    case R.id.drawer_vtex:                        if (message) {                        } else {                            alert_info();                        }                        break;                    case R.id.drawer_like:                        if (message) {                            dialog = new BottomSheetDialog(MainActivity.this);                            View view = LayoutInflater.from(MainActivity.this).inflate(R.layout.user_share, null);                            dialog.setContentView(view);                            dialog.show();                            user_share(view, dialog);                        } else {                            alert_info();                        }                        break;                    case R.id.drawer_setting:                        if (message) {                        } else {                            alert_info();                        }                        break;                    case R.id.drawer_about:                        if (message) {                        } else {                            alert_info();                        }                        break;                }                return true;            }        });        //初始化Listener        ShareConfig config = ShareConfig.instance()                .qqId("101410114")                .weiboId("10121212")                .wxId("12224412");        ShareManager.init(config);        mShareListener = new ShareListener() {            @Override            public void shareSuccess() {                Toast.makeText(MainActivity.this, "分享成功", Toast.LENGTH_SHORT).show();            }            @Override            public void shareFailure(Exception e) {                Toast.makeText(MainActivity.this, "分享失败", Toast.LENGTH_SHORT).show();            }            @Override            public void shareCancel() {                Toast.makeText(MainActivity.this, "取消分享", Toast.LENGTH_SHORT).show();            }        };    }    //用户分享    private void user_share(View view, final BottomSheetDialog dialog) {        view.findViewById(R.id.share_qq).setOnClickListener(this);        view.findViewById(R.id.share_weixin).setOnClickListener(this);        view.findViewById(R.id.share_friend).setOnClickListener(this);        view.findViewById(R.id.share_weibo).setOnClickListener(this);        view.findViewById(R.id.share_zone).setOnClickListener(this);    }//    private void setDefaultFragment()//    {//        FragmentManager fm = getFragmentManager();//        FragmentTransaction transaction = fm.beginTransaction();//        mZhihuFragment = new ZhihuMainFragment();//        transaction.replace(R.id.Group_Lin, mZhihuFragment);//        transaction.commit();//    }    private void goneFragment() {        ft = fm.beginTransaction();        if (mZhihuFragment != null) {            ft.hide(mZhihuFragment);        }        if (mGankFragment != null) {            ft.hide(mGankFragment);        }        if (mWechatFragment != null) {            ft.hide(mWechatFragment);        }        if (mGoldFragment != null) {            ft.hide(mGoldFragment);        }        if (mVtexFragment != null) {            ft.hide(mVtexFragment);        }//        if (mLikeFragment != null) {//            ft.hide(mLikeFragment);//        }        if (mSettingFragment != null) {            ft.hide(mSettingFragment);        }        if (mAboutFragment != null) {            ft.hide(mAboutFragment);        }        ft.commit();    }    private void SelectFragment(int id) {        goneFragment();        ft = fm.beginTransaction();        switch (id) {            case R.id.drawer_zhihu:                if (mZhihuFragment == null) {                    mZhihuFragment = new ZhihuMainFragment();                    ft.add(R.id.Group_Lin, mZhihuFragment);                } else {                    ft.show(mZhihuFragment);                }                break;            case R.id.drawer_wechat:                if (mWechatFragment == null) {                    mWechatFragment = new WechatMainFragment();                    ft.add(R.id.Group_Lin, mWechatFragment);                } else {                    ft.show(mWechatFragment);                }                break;            case R.id.drawer_gank:                if (mGankFragment == null) {                    mGankFragment = new GankMainFragment();                    ft.add(R.id.Group_Lin, mGankFragment);                } else {                    ft.show(mGankFragment);                }                break;            case R.id.drawer_gold:                if (mGoldFragment == null) {                    mGoldFragment = new GoldMainFragment();                    ft.add(R.id.Group_Lin, mGoldFragment);                } else {                    ft.show(mGoldFragment);                }                break;            case R.id.drawer_vtex:                if (mVtexFragment == null) {                    mVtexFragment = new VtexMainFragment();                    ft.add(R.id.Group_Lin, mVtexFragment);                } else {                    ft.show(mVtexFragment);                }                break;//            case R.id.drawer_like://////                if (mLikeFragment == null) {////                    mLikeFragment = new LikeFragment();////                    ft.add(R.id.Group_Lin, mLikeFragment);////                } else {////                    ft.show(mLikeFragment);////                }//////                break;            case R.id.drawer_setting:                if (mSettingFragment == null) {                    mSettingFragment = new SettingFragment();                    ft.add(R.id.Group_Lin, mSettingFragment);                } else {                    ft.show(mSettingFragment);                }                break;            case R.id.drawer_about:                if (mAboutFragment == null) {                    mAboutFragment = new AboutFragment();                    ft.add(R.id.Group_Lin, mAboutFragment);                } else {                    ft.show(mAboutFragment);                }                break;        }        ft.commit();    }    private long mkeyTime = 0;    @Override    public boolean onKeyDown(int keyCode, KeyEvent event) {        if (keyCode == KeyEvent.KEYCODE_BACK) {            if ((System.currentTimeMillis() - mkeyTime) > 1000) {                mkeyTime = System.currentTimeMillis();                Toast.makeText(this, "再按一次退出应用", Toast.LENGTH_SHORT).show();            } else {                finish();                System.exit(0);            }            return false;        }        return super.onKeyDown(keyCode, event);    }    //请先登录的提示    public void alert_info() {        new AlertDialog.Builder(MainActivity.this).setTitle("消息提示").setMessage("请您先登录?").setNegativeButton("确定", null).show();    }    private SharedPreferences sp;    private SharedPreferences.Editor editor;    private Boolean message;    private View headerlayout;    private CircleImageView imageView;    private CircleImageView LoginimageView;    public void get_Info() {        sp = getSharedPreferences("user_auth", Activity.MODE_PRIVATE);        editor = sp.edit();        message = sp.getBoolean("message", false);        LayoutInflater layoutInflater = LayoutInflater.from(this);        if(!message) {            mNavigationView.addHeaderView(layoutInflater.inflate(R.layout.navigation_header_before, mNavigationView, false));            headerlayout = mNavigationView.getHeaderView(0);            imageView = (CircleImageView) headerlayout.findViewById(R.id.profile_image_before);            imageView.setOnClickListener(this);        }else{            mNavigationView.addHeaderView(layoutInflater.inflate(R.layout.navigation_header, mNavigationView, false));            headerlayout = mNavigationView.getHeaderView(0);            LoginimageView = (CircleImageView) headerlayout.findViewById(R.id.profile_image);            LoginimageView.setOnClickListener(this);            TextView tv_header = (TextView) headerlayout.findViewById(R.id.tv_header);            TextView followers = (TextView) headerlayout.findViewById(R.id.followers);            TextView following = (TextView) headerlayout.findViewById(R.id.following);            tv_header.setText(sp.getString("name", "Laravel"));            followers.setText(sp.getInt("followers", 0) + "");            following.setText(sp.getInt("following", 0) + "");        }    }    //退出登录    public void logout() {        SharedPreferences.Editor editor = sp.edit();        editor.clear();        editor.commit();        Intent i = getIntent();        finish();        startActivity(i);    }    @Override    public void onClick(View v) {        switch (v.getId()) {            case R.id.profile_image_before:            mDrawwerLayout.closeDrawers();//关闭navigationview            startActivity(new Intent(this, UserLoginAndRegister.class));//启动用户登录界面                break;            case R.id.profile_image:                if(message) {                    new AlertDialog.Builder(MainActivity.this).setTitle("退出登录").setMessage("确认退出登录吗?").setNegativeButton("取消", null).setPositiveButton("确定", new DialogInterface.OnClickListener() {                        @Override                        public void onClick(DialogInterface dialog, int which) {                            logout();                        }                    }).show();                }                break;            case R.id.share_qq:                ShareUtil.shareImage(MainActivity.this, SharePlatform.QQ,                        "http://shaohui.me/images/avatar.gif", mShareListener);                dialog.hide();                break;            case R.id.share_weixin:                ShareUtil.shareText(MainActivity.this, SharePlatform.WX, "分享文字", mShareListener);                dialog.hide();                break;            case R.id.share_weibo:                ShareUtil.shareImage(MainActivity.this, SharePlatform.WEIBO,                        "http://shaohui.me/images/avatar.gif", mShareListener);                dialog.hide();                break;            case R.id.share_zone:                ShareUtil.shareMedia(MainActivity.this, SharePlatform.QZONE, "Title", "summary",                        "http://shaohui.me/images/avatar.gif", "http://shaohui.me/images/avatar.gif",                        mShareListener);                dialog.hide();                break;            case R.id.share_friend:                ShareUtil.shareText(MainActivity.this, SharePlatform.WX_TIMELINE, "测试分享文字",                        mShareListener);                dialog.hide();                break;        }    }}